# Snapshot Testing Setup Instructions

This document provides step-by-step instructions to complete the snapshot testing setup for your iOS app.

## Prerequisites

✅ Fastlane is already installed and configured
✅ Snapshot test files have been created
✅ Fastlane configuration is ready

## Manual Setup Steps (Required)

### 1. Add SnapshotTesting Package Dependency

Since we cannot programmatically modify the Xcode project file, you need to manually add the SnapshotTesting dependency:

1. Open `temp_0.xcodeproj` in Xcode
2. Select the project in the navigator
3. Go to the "Package Dependencies" tab
4. Click the "+" button
5. Enter this URL: `https://github.com/pointfreeco/swift-snapshot-testing`
6. Click "Add Package"
7. Select "SnapshotTesting" and add it to the `temp_0Tests` target
8. Also add it to the `temp_0UITests` target if you want UI snapshot testing

### 2. Add Snapshot Helper to UI Tests

For Fastlane screenshots to work, you need to add the snapshot helper:

1. In Xcode, select the `temp_0UITests` target
2. Go to Build Settings
3. Search for "Other Swift Flags"
4. Add `-DFASTLANE_SNAPSHOT` to the Debug configuration

### 3. Import SnapshotHelper

The UI test file `FastlaneSnapshotUITests.swift` needs the snapshot helper. Run this command to generate it:

```bash
fastlane snapshot init
```

This will create a `SnapshotHelper.swift` file that you need to add to your UI test target.

## Available Fastlane Lanes

Once setup is complete, you can use these lanes:

### `fastlane test`
Runs unit tests with snapshot testing on iPhone 15 Pro simulator.

### `fastlane screenshots`
Generates app screenshots for different devices and languages using Fastlane's snapshot tool.

### `fastlane snapshot_tests`
Runs both unit tests and generates screenshots - the complete snapshot testing workflow.

### `fastlane setup_snapshot`
Shows setup instructions and tips.

### `fastlane clean_build`
Cleans and rebuilds the project.

## File Structure

```
temp_0/
├── fastlane/
│   ├── Fastfile          # Fastlane configuration with snapshot lanes
│   ├── Appfile           # App configuration
│   └── Snapfile          # Snapshot configuration (devices, languages)
├── temp_0Tests/
│   └── SnapshotTests.swift    # Unit snapshot tests
├── temp_0UITests/
│   ├── FastlaneSnapshotUITests.swift  # UI tests for screenshots
│   └── SnapshotHelper.swift           # (Generated by fastlane snapshot init)
└── screenshots/          # (Generated) Screenshot output directory
```

## Testing Your Setup

1. First, generate the snapshot helper:
   ```bash
   fastlane snapshot init
   ```

2. Add the generated `SnapshotHelper.swift` to your UI test target in Xcode

3. Run the setup verification:
   ```bash
   fastlane setup_snapshot
   ```

4. Test unit snapshot tests:
   ```bash
   fastlane test
   ```

5. Test screenshot generation:
   ```bash
   fastlane screenshots
   ```

6. Run the complete workflow:
   ```bash
   fastlane snapshot_tests
   ```

## Snapshot Types

### Unit Test Snapshots (SnapshotTesting)
- Tests individual SwiftUI views
- Saves reference images in `temp_0Tests/__Snapshots__/`
- Compares against reference images on subsequent runs
- Fails tests if UI changes unexpectedly

### UI Screenshots (Fastlane Snapshot)
- Takes full app screenshots
- Saves screenshots in `screenshots/` directory
- Useful for App Store submissions
- Supports multiple devices and languages

## Customization

### Adding More Devices
Edit `fastlane/Snapfile` and add device names to the `devices` array.

### Adding More Languages
Edit `fastlane/Snapfile` and add language codes to the `languages` array.

### Adding More Snapshot Tests
Add test methods to `SnapshotTests.swift` for testing different views or states.

### Adding More Screenshot Flows
Add navigation and snapshot calls to `FastlaneSnapshotUITests.swift`.

## Troubleshooting

### Build Errors
- Ensure SnapshotTesting package is added to test targets
- Check that import statements are correct
- Verify scheme includes test targets

### Screenshot Failures
- Ensure UI test scheme is properly configured
- Check that simulators are available
- Verify app launches successfully in tests

### Snapshot Comparison Failures
- Set `isRecording = true` in test setup to record new reference images
- Check that view rendering is consistent
- Consider device-specific differences

## Next Steps

After completing the manual setup:

1. Run `fastlane snapshot_tests` to generate your first snapshots
2. Commit the reference images to version control
3. Set up CI/CD to run snapshot tests automatically
4. Consider adding more views and test cases
